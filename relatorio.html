<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Relat칩rio de Card치pio</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    
  table {
    border-collapse: collapse;
    margin-top: 20px;
    width: 90%;
    max-width: 900px;
  }
  th, td {
    padding: 12px;
    text-align: center;
    border: 1px solid #ccc;
    font-size: 16px;
  }
  th {
    background-color: #f4f4f4;
  }
  .promover {
    background-color: #d4edda;
    color: #155724;
    font-weight: bold;
  }
  .revisar {
    background-color: #fff3cd;
    color: #856404;
    font-weight: bold;
  }
  .remover {
    background-color: #f8d7da;
    color: #721c24;
    font-weight: bold;
  }
</style>

</head>
<body>
  <h1>游늵 Relat칩rio do Card치pio</h1>
  
  <table border="1" cellpadding="10">
  <thead>
    <tr>
      <th>Prato</th>
      <th>Quantidade Vendida</th>
      <th>Receita (R$)</th>
      <th>Margem (R$)</th>
      <th>Margem (%)</th>
      <th>Recomenda칞칚o</th>
    </tr>
  </thead>
  <tbody id="tabela-pratos"></tbody>
</table>

  <canvas id="grafico" width="400" height="200"></canvas>
  <canvas id="graficoPizza" width="400" height="200"></canvas>


  <script>
fetch("http://localhost:3000/analise-cardapio")
  .then(res => res.json())
  .then(data => {
    const corpo = document.getElementById("tabela-pratos");
    const labels = [];
    const receitas = [];

data.forEach(prato => {
  let classeRecomendacao = "";
  if (prato.recomendacao === "promover") {
    classeRecomendacao = "promover";
  } else if (prato.recomendacao === "revisar") {
    classeRecomendacao = "revisar";
  } else if (prato.recomendacao === "remover") {
    classeRecomendacao = "remover";
  }

  const row = `
    <tr>
      <td>${prato.nome}</td>
      <td>${prato.quantidade}</td>
      <td>R$ ${prato.receita.toFixed(2)}</td>
      <td>R$ ${prato.margem.toFixed(2)}</td>
      <td>${prato.margemPercentual.toFixed(1)}%</td>
      <td class="${classeRecomendacao}">${prato.recomendacao.toUpperCase()}</td>
    </tr>
  `;
  corpo.innerHTML += row;

  labels.push(prato.nome);
  receitas.push(prato.receita);
});
    

    // Gr치fico de barras
    new Chart(document.getElementById("grafico"), {
      type: "bar",
      data: {
        labels: labels,
        datasets: [{
          label: "Receita por prato",
          data: receitas,
          backgroundColor: "rgba(75, 192, 192, 0.6)"
        }]
      }
    });

    // Gr치fico de pizza
    new Chart(document.getElementById("graficoPizza"), {
      type: "pie",
      data: {
        labels: labels,
        datasets: [{
          label: "Participa칞칚o no total",
          data: receitas,
          backgroundColor: [
            "rgba(255, 99, 132, 0.6)",
            "rgba(54, 162, 235, 0.6)",
            "rgba(255, 206, 86, 0.6)",
            "rgba(75, 192, 192, 0.6)",
            "rgba(153, 102, 255, 0.6)",
            "rgba(255, 159, 64, 0.6)"
          ]
        }]
      }
    });
  });

    
  </script>
</body>
</html>
